/**
 * antimeta-sideloader - A standalone Metadata scrubber and Picture App.
 * @version v0.0.1
 * @link 
 * @license 
 */
!function(){"use strict";angular.module("metapurge",["ui.bootstrap","ngRoute","ngAnimate","ngTouch","antimeta.controllers"]).config(["$routeProvider","$locationProvider","$animateProvider",function(e,t,a){a.classNameFilter(/animate-/),t.html5Mode(!0),e.when("/metapurge/",{templateUrl:"/index.html",controller:"Upload"}),e.otherwise({redirectTo:"/metapurge/"})}]).run(["$route","$rootScope","$location",function(e,t,a){var o=a.path;a.path=function(n,i){if(i===!1)var l=e.current,s=t.$on("$locationChangeSuccess",function(){e.current=l,s()});return o.apply(a,[n])}}])}(),function(){"use strict";angular.module("antimeta.controllers",["ngAnimate"]).controller("Upload",["$scope","$q","$http",function(e,t,a){function o(e){function t(t){var o=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/,n=o.exec(t)[1];void 0===a[n]&&e(n),a[n]=!0}var a={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=!!window.webkitRTCPeerConnection;if(!o){var i=$("iframe")[0],l=i.contentWindow;o=l.RTCPeerConnection||l.mozRTCPeerConnection||l.webkitRTCPeerConnection,n=!!l.webkitRTCPeerConnection}var s={optional:[{RtpDataChannels:!0}]},r={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},c=new o(r,s);c.onicecandidate=function(e){e.candidate&&t(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&t(e)})},1e3)}e.someData=null;t.defer();e.setMessage=function(t,a,o){clearTimeout(window.messageTimer),o||(o="label-default"),e.$apply(function(){e.messageCenter=null,e.messageCenter={message:t,"class":o}}),a>-1&&(window.messageTimer=setTimeout(function(){e.$apply(function(){e.messageCenter=null})},a))},e.getMyIP=function(){o(function(t){if(t)console.log(t),t.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?(e.IPv4=t,e.intranetIPfound=!0,e.$digest()):t.match(/^[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}$/)?(e.IPv6=t,e.intranetIPfound=!0,e.$digest()):(e.IPvPUBLIC=t,e.intranetIPfound=!0,e.$digest());else{var o="http://freegeoip.net/json/";a.get(o,{responseType:"json"}).success(function(t,a,o,n){e.IPv4=t.ip,e.intranetIPfound=!0,e.$digest()})}})},window.setMessage=function(t,a,o){e.setMessage(t,a,o)},Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.uploaderLink=$("a#previewerLink"),Filter.types(),Canvas.init(),Canvas.resizeCanvas(),Canvas.filters(),MainInterface.upload()}])}(),function(){function e(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}function t(e,t){void 0===Date.prototype[e]&&(Date.prototype[e]=t)}var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l={su:0,sun:0,sunday:0,mo:1,mon:1,monday:1,tu:2,tue:2,tuesday:2,we:3,wed:3,wednesday:3,th:4,thu:4,thursday:4,fr:5,fri:5,friday:5,sa:6,sat:6,saturday:6},s=o.concat(a),r=["su","sun","sunday","mo","mon","monday","tu","tue","tuesday","we","wed","wednesday","th","thu","thursday","fr","fri","friday","sa","sat","saturday"],c={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},u=[31,28,31,30,31,30,31,31,30,31,30,31],d=function(e){return e.match(/^(\d+)$/)?!0:!1},g=function(e,t,a,o){for(var n=o;n>=a;n--){var i=e.substring(t,t+n);if(i.length<a)return null;if(d(i))return i}return null},f=Date.parse,h=function(e,t){e+="",t+="";for(var a,o,n=0,i=0,l="",c="",u=new Date,d=u.getYear(),f=u.getMonth()+1,h=1,v=0,b=0,m=0,G="";i<t.length;){for(l=t.charAt(i),c="";t.charAt(i)===l&&i<t.length;)c+=t.charAt(i++);if("yyyy"===c||"yy"===c||"y"===c){if("yyyy"===c&&(a=4,o=4),"yy"===c&&(a=2,o=2),"y"===c&&(a=2,o=4),d=g(e,n,a,o),null===d)return NaN;n+=d.length,2===d.length&&(d=d>70?1900+(d-0):2e3+(d-0))}else if("MMM"===c||"NNN"===c){f=0;for(var w=0;w<s.length;w++){var p=s[w];if(e.substring(n,n+p.length).toLowerCase()===p.toLowerCase()&&("MMM"===c||"NNN"===c&&w>11)){f=w+1,f>12&&(f-=12),n+=p.length;break}}if(1>f||f>12)return NaN}else if("EE"===c||"E"===c)for(var D=0;D<r.length;D++){var T=r[D];if(e.substring(n,n+T.length).toLowerCase()===T.toLowerCase()){n+=T.length;break}}else if("MM"===c||"M"===c){if(f=g(e,n,c.length,2),null===f||1>f||f>12)return NaN;n+=f.length}else if("dd"===c||"d"===c){if(h=g(e,n,c.length,2),null===h||1>h||h>31)return NaN;n+=h.length}else if("hh"===c||"h"===c){if(v=g(e,n,c.length,2),null===v||1>v||v>12)return NaN;n+=v.length}else if("HH"===c||"H"===c){if(v=g(e,n,c.length,2),null===v||0>v||v>23)return NaN;n+=v.length}else if("KK"===c||"K"===c){if(v=g(e,n,c.length,2),null===v||0>v||v>11)return NaN;n+=v.length}else if("kk"===c||"k"===c){if(v=g(e,n,c.length,2),null===v||1>v||v>24)return NaN;n+=v.length,v--}else if("mm"===c||"m"===c){if(b=g(e,n,c.length,2),null===b||0>b||b>59)return NaN;n+=b.length}else if("ss"===c||"s"===c){if(m=g(e,n,c.length,2),null===m||0>m||m>59)return NaN;n+=m.length}else if("a"===c){if("am"===e.substring(n,n+2).toLowerCase())G="AM";else{if("pm"!==e.substring(n,n+2).toLowerCase())return NaN;G="PM"}n+=2}else{if(e.substring(n,n+c.length)!==c)return NaN;n+=c.length}}if(n!==e.length)return NaN;if(2===f)if(d%4===0&&d%100!==0||d%400===0){if(h>29)return NaN}else if(h>28)return NaN;if((4===f||6===f||9===f||11===f)&&h>30)return NaN;12>v&&"PM"===G?v=v-0+12:v>11&&"AM"===G&&(v-=12);var C=new Date(d,f-1,h,v,b,m);return C.getTime()};Date.parse=function(e,t){if(t)return h(e,t);var a,o=f(e),n=0;return isNaN(o)&&(a=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?))?/.exec(e))&&("Z"!==a[8]&&(n=60*+a[10]+ +a[11],"+"===a[9]&&(n=0-n)),a[7]=a[7]||"000",o=Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5]+n,+a[6],+a[7].substr(0,3))),o},Date.today=function(){return(new Date).clearTime()},Date.UTCtoday=function(){return(new Date).clearUTCTime()},Date.tomorrow=function(){return Date.today().add({days:1})},Date.UTCtomorrow=function(){return Date.UTCtoday().add({days:1})},Date.yesterday=function(){return Date.today().add({days:-1})},Date.UTCyesterday=function(){return Date.UTCtoday().add({days:-1})},Date.validateDay=function(e,t,a){var o=new Date(t,a,e);return o.getFullYear()===t&&o.getMonth()===a&&o.getDate()===e},Date.validateYear=function(e){return e>=0&&9999>=e},Date.validateSecond=function(e){return e>=0&&60>e},Date.validateMonth=function(e){return e>=0&&12>e},Date.validateMinute=function(e){return e>=0&&60>e},Date.validateMillisecond=function(e){return e>=0&&1e3>e},Date.validateHour=function(e){return e>=0&&24>e},Date.compare=function(e,t){return e.valueOf()<t.valueOf()?-1:e.valueOf()>t.valueOf()?1:0},Date.equals=function(e,t){return e.valueOf()===t.valueOf()},Date.getDayNumberFromName=function(e){return l[e.toLowerCase()]},Date.getMonthNumberFromName=function(e){return c[e.toLowerCase()]},Date.isLeapYear=function(e){return 29===new Date(e,1,29).getDate()},Date.getDaysInMonth=function(e,t){return 1===t?Date.isLeapYear(e)?29:28:u[t]},t("getMonthAbbr",function(){return a[this.getMonth()]}),t("getMonthName",function(){return o[this.getMonth()]}),t("getUTCOffset",function(){var t=e(Math.abs(this.getTimezoneOffset()/.6),4);return this.getTimezoneOffset()>0&&(t="-"+t),t}),t("toCLFString",function(){return e(this.getDate(),2)+"/"+this.getMonthAbbr()+"/"+this.getFullYear()+":"+e(this.getHours(),2)+":"+e(this.getMinutes(),2)+":"+e(this.getSeconds(),2)+" "+this.getUTCOffset()}),t("toYMD",function(t){return t="undefined"==typeof t?"-":t,this.getFullYear()+t+e(this.getMonth()+1,2)+t+e(this.getDate(),2)}),t("toDBString",function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1,2)+"-"+e(this.getUTCDate(),2)+" "+e(this.getUTCHours(),2)+":"+e(this.getUTCMinutes(),2)+":"+e(this.getUTCSeconds(),2)}),t("clearTime",function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this}),t("clearUTCTime",function(){return this.setUTCHours(0),this.setUTCMinutes(0),this.setUTCSeconds(0),this.setUTCMilliseconds(0),this}),t("add",function(e){return void 0!==e.milliseconds&&this.setMilliseconds(this.getMilliseconds()+e.milliseconds),void 0!==e.seconds&&this.setSeconds(this.getSeconds()+e.seconds),void 0!==e.minutes&&this.setMinutes(this.getMinutes()+e.minutes),void 0!==e.hours&&this.setHours(this.getHours()+e.hours),void 0!==e.days&&this.setDate(this.getDate()+e.days),void 0!==e.weeks&&this.setDate(this.getDate()+7*e.weeks),void 0!==e.months&&this.setMonth(this.getMonth()+e.months),void 0!==e.years&&this.setFullYear(this.getFullYear()+e.years),this}),t("addMilliseconds",function(e){return this.add({milliseconds:e})}),t("addSeconds",function(e){return this.add({seconds:e})}),t("addMinutes",function(e){return this.add({minutes:e})}),t("addHours",function(e){return this.add({hours:e})}),t("addDays",function(e){return this.add({days:e})}),t("addWeeks",function(e){return this.add({days:7*e})}),t("addMonths",function(e){return this.add({months:e})}),t("addYears",function(e){return this.add({years:e})}),t("setTimeToNow",function(){var e=new Date;this.setMilliseconds(e.getMilliseconds()),this.setSeconds(e.getSeconds()),this.setMinutes(e.getMinutes()),this.setHours(e.getHours())}),t("clone",function(){return new Date(this.valueOf())}),t("between",function(e,t){return this.valueOf()>=e.valueOf()&&this.valueOf()<=t.valueOf()}),t("compareTo",function(e){return Date.compare(this,e)}),t("equals",function(e){return Date.equals(this,e)}),t("isAfter",function(e){return e=e?e:new Date,this.compareTo(e)>0}),t("isBefore",function(e){return e=e?e:new Date,this.compareTo(e)<0}),t("getDaysBetween",function(e){return(e.clone().valueOf()-this.valueOf())/864e5|0}),t("getHoursBetween",function(e){return(e.clone().valueOf()-this.valueOf())/36e5|0}),t("getMinutesBetween",function(e){return(e.clone().valueOf()-this.valueOf())/6e4|0}),t("getSecondsBetween",function(e){return(e.clone().valueOf()-this.valueOf())/1e3|0}),t("getMillisecondsBetween",function(e){return e.clone().valueOf()-this.valueOf()|0}),t("getOrdinalNumber",function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1}),t("toFormat",function(e){return v(e,b(this))}),t("toUTCFormat",function(e){return v(e,m(this))});var v=function(e,t){var a,o,n,i=[e],l=function(e,t){for(var a,o,n,l=0,s=i.length,r=[];s>l;l++)if("string"==typeof i[l]){for(n=i[l].split(e),a=0,o=n.length-1;o>a;a++)r.push(n[a]),r.push([t]);r.push(n[o])}else r.push(i[l]);i=r};for(a in t)l(a,t[a]);for(n="",a=0,o=i.length;o>a;a++)n+="string"==typeof i[a]?i[a]:i[a][0];return i.join("")},b=function(t){var l=t.getHours()%12?t.getHours()%12:12;return{YYYY:t.getFullYear(),YY:String(t.getFullYear()).slice(-2),MMMM:o[t.getMonth()],MMM:a[t.getMonth()],MM:e(t.getMonth()+1,2),MI:e(t.getMinutes(),2),M:t.getMonth()+1,DDDD:i[t.getDay()],DDD:n[t.getDay()],DD:e(t.getDate(),2),D:t.getDate(),HH24:e(t.getHours(),2),HH:e(l,2),H:l,SS:e(t.getSeconds(),2),PP:t.getHours()>=12?"PM":"AM",P:t.getHours()>=12?"pm":"am",LL:e(t.getMilliseconds(),3)}},m=function(t){var l=t.getUTCHours()%12?t.getUTCHours()%12:12;return{YYYY:t.getUTCFullYear(),YY:String(t.getUTCFullYear()).slice(-2),MMMM:o[t.getUTCMonth()],MMM:a[t.getUTCMonth()],MM:e(t.getUTCMonth()+1,2),MI:e(t.getUTCMinutes(),2),M:t.getUTCMonth()+1,DDDD:i[t.getUTCDay()],DDD:n[t.getUTCDay()],DD:e(t.getUTCDate(),2),D:t.getUTCDate(),HH24:e(t.getUTCHours(),2),HH:e(l,2),H:l,SS:e(t.getUTCSeconds(),2),PP:t.getUTCHours()>=12?"PM":"AM",P:t.getUTCHours()>=12?"pm":"am",LL:e(t.getUTCMilliseconds(),3)}}}(),angular.module("antimeta.directives",[]).filter("toArray",function(){"use strict";return function(e){var t=[];return angular.forEach(e,function(e,a){e.offset!==!1&&t.push(e)}),t}}).directive("categories",function(){}).directive("whenScrolled",function(){"use strict";return function(e,t,a){var o=t[0],n=window.getComputedStyle(o),i=n.getPropertyValue("overflow-x");"scroll"===i?t.bind("scroll",function(){o.scrollLeft+o.offsetWidth>=o.scrollWidth-60&&e.$apply(a.whenScrolled)}):t.bind("scroll",function(){o.scrollTop+o.offsetHeight>=o.scrollHeight-60&&e.$apply(a.whenScrolled)})}}).directive("filterListView",function(){"use strict"}).directive("clickJacker",function(){"use strict";return function(e,t,a){t[0];$(t).bind("click",function(){e.$apply(a.clickJacker)})}});var MainInterface={menu:function(e){"use strict";var t,a;$(".nav a:last").hasClass("hidden")===!0&&$(".nav a:nth-last-of-type(2)").addClass("roundedBottom"),$(".openMenu").unbind("click").bind("click",function(){$(".nav a:nth-last-of-type(2)").hasClass("roundedBottom")===!0?$(".nav a:nth-last-of-type(2)").removeClass("roundedBottom"):$(".nav a:last").hasClass("hidden")===!0&&$(".nav a:nth-last-of-type(2)").addClass("roundedBottom"),$(".nav").toggle(100),$(this).blur()}),"autohide"===e?(t=window.setTimeout(function(){$(".openMenu,.nav").fadeOut(500),$("*").css("cursor","none")},5e3),$(document).on("mousemove","*",function(){$("*").css("cursor","auto")}).on("click","canvas",function(){$(".openMenu").fadeIn(500),window.setTimeout(t)}).on("mouseover",".nav",function(){window.clearTimeout(a),window.clearTimeout(t)}).on("mouseleave",".nav",function(){window.setTimeout(t),$(".nav").fadeOut(250)})):(a=window.setTimeout(function(){$(".nav").fadeOut(500)},5e3),$(document).on("mouseover",".nav",function(){window.clearTimeout(a),window.clearTimeout(t)}).on("mouseleave",".nav",function(){$(".nav").fadeOut(250),$("img.teampics").unbind("click").bind("click",function(){Global.NEWTEAMMATEcontributor_id=$(this).attr("ng-contributor_id"),$("img.teampics").removeClass("selectedForTeam"),$(this).addClass("selectedForTeam"),Global.reference_image_id=$(this).attr("ng-reference_image_id")})})),$("a:not(.stayhere)").unbind("click").bind("click",function(e){e.preventDefault();var t=Canvas.stopCam(),a=$(this).attr("href"),o=window.setInterval(function(){t===!0&&(window.clearInterval(o),window.location.href=a)},250)}),$("a.stayhere").unbind("click").bind("click",function(e){e.preventDefault(),$("#allPics").toggleClass("hidden"),$(".nav").fadeOut(250)})},upload:function(){"use strict";function e(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}e()===!1?($("#camera,#camchoice").remove(),$("#accept").css("padding-right","50px")):$("#camera,#camchoice").click(function(){function e(){window.localMediaStream&&(clearTimeout(window.turnOnCamera),clearTimeout(window.cameraProblems),clearInterval(window.cameraInterval))}Tools.loading(!0),window.turnOnCamera=setTimeout(function(){$("#load").is(":visible")},5e3),window.cameraProblems=setTimeout(function(){$("#load").is(":visible")&&$("#nativeFile .fa").addClass("oneblink")},3e4),Canvas.init(),window.cameraInterval=setInterval(e,1e3)}),$(window).smartresize(function(){setTimeout(function(){Canvas.resizeCanvas()},500)}),$("#city").on("click",function(){$("#cityChooser").fadeIn()}),$("#nativeFile,#filechoice").click(function(){$("input#filechooser").trigger("click")}),$("input#filechooser").on("click",function(){function e(){Global.file&&(Tools.loading("stop"),clearInterval(window.fileInterval))}setTimeout(function(){Global.file||($("input#filechooser").attr("capture","camera").removeClass("hidden"),clearInterval(window.fileInterval))},15e3),window.fileInterval=setInterval(e,100)}).off("change").on("change",function(e){Global.file=this.files[0],Global.file&&(Tools.isImage(Global.file.type)===!0?(Canvas.fromImage(e),Tools.activate("filechoice"),$(".step1").hide(),$(".step3").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500)):setTimeout(function(){window.location.reload(!0)},3e3))}),$("#accept.action,canvas").click(function(){Tools.flash(),$(".step1").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500),Canvas.freezer()}),$("#cancel").click(function(){$(".step2").hide(),$(".step1").fadeIn(500),$(".step3").hide(),Canvas.releaser()}),$("#settings span.trigger").click(function(){$(".step3").hasClass("hidden")?($(".step3").hide().removeClass("hidden").fadeIn(500),$("#settings i.fa-stack-2x").addClass("fa-circle"),$("#settings i.fa-stack-1x").addClass("white")):($(".step3").fadeOut(250).addClass("hidden"),$("#settings .trigger").blur(),$("#settings .fa-stack-2x").removeClass("fa-circle"),$("#settings .fa-stack-1x").removeClass("white"))}),$(".step3 button").click(function(){$("#settings .trigger").click()}),$("#upload").bind("click",function(){$(".step2").addClass("hidden"),Canvas.upload()})}},Global={ns:null,video:document.querySelector("video"),canvas:document.querySelector("canvas#previewer"),ctx:null,videoSettings:{audio:!1,video:{mandatory:{minWidth:1920,minHeight:1080}}},localMediaStream:null,uploaderLink:$("a#previewerLink"),imageTypes:["image/png","image/x-apple-ios-png","image/x-png","image/jpeg","image/gif","image/bmp"],sourceX:null,sourceY:null,sourceWidth:null,sourceHeight:null,destWidth:null,destHeight:null,destX:0,destY:0,canvasWidth:850,canvasHeight:850,imageObj:new Image,imageData:null,iData:null,iData2:null,iData3:null,file:null,previewH:null,previewW:null,angleRotate:0,uploadLock:!1,logoLock:!1,videoFeedLock:!1,startWindowHeight:null,exif:null,EXIFlat:"Location Unknown",GPSlat:"Location Unknown",EXIFlong:"Location Unknown",GPSlong:"Location Unknown",GPSaccuracy:null,flash:$("#flash"),user:null,team_id:null},Tools={getLat:function(){return"Location Unknown"!=Global.EXIFlat?Global.EXIFlat:"Location Unknown"!=Global.GPSlat?Global.GPSlat:void 0==Global.city?53.5555252:"Hamburg"===Global.city?53.5555252:"Tallinn"===Global.city?59.443764:"Paris"===Global.city?48.8588589:void 0},getLong:function(){return"Location Unknown"!==Global.EXIFlong?Global.EXIFlong:"Location Unknown"!==Global.GPSlong?Global.GPSlong:void 0===Global.city?9.98361312:"Hamburg"===Global.city?9.98361312:"Tallinn"===Global.city?24.779466:"Paris"===Global.city?2.3470599:void 0},exif:function(e){var t=new FileReader;t.onload=function(e){try{var t=new ExifReader;t.load(e.target.result),Global.EXIFDATA=t.getAllTags();var a=new Array;angular.forEach(Global.EXIFDATA,function(e,t){e.offset!==!1&&e.description.length<=30&&a.push(t+": "+e.description+"<br>\n\r")}),console.log(a),$("#metaData #data").html(a),Canvas.transformCoordinate(t.getTagDescription("Orientation"));var o=t.getTagDescription("GPSLatitude"),n=t.getTagDescription("GPSLongitude");void 0!==o&&void 0!==n?(Global.EXIFlat=o,Global.EXIFlong=n,$("#city").text("Photo Location Data")):(Global.EXIFlat="Location Unknown",Global.EXIFlong="Location Unknown")}catch(i){console.log("No Exif Information"),$("#metaData #data").html("No Exif Information")}},t.readAsArrayBuffer(Global.file)},geo:function(e){"use strict";function t(t){Global.GPSlat=t.coords.latitude,Global.GPSlong=t.coords.longitude,Global.GPSaccuracy=t.coords.accuracy,$("#city").text("GPS Active"),e.location=t,console.log(e.location)}function a(){Global.GPSlat="Location Unknown",Global.GPSlong="Location Unknown",$("#city").text(Global.GPSlat)}geoPosition.init()&&geoPosition.getCurrentPosition(t,a,{enableHighAccuracy:!0})},flash:function(){Global.flash.removeClass("hidden"),setTimeout(function(){Global.flash.addClass("hidden")},500)},activate:function(e){$(".active .fa-stack-1x").removeClass("blinky"),$(".active").removeClass("active"),"camchoice"===e?($("#camchoice .fa-stack-1x").addClass("blinky"),$("#camchoice").addClass("active")):"filechoice"===e&&($("#filechoice .fa-stack-1x").addClass("blinky"),$("#filechoice").addClass("active"))},onCameraFail:function(e){this.error=e.name||e,clearTimeout(window.turnOnCamera),clearInterval(window.cameraInterval)},size:function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&(a+=1);return a},isImage:function(e){return $.inArray(e,Global.imageTypes)>-1?(Tools.loading("stop"),!0):!1},cancel:function(){$("#cancel").click()},cancelEvent:function(e){return e=e?e:window.event,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1},loading:function(e,t){return e===!0?void $(".spinner").removeClass("hidden"):void("start"===e?$("#load").show():$("#load").hide())}},Filter={grayscale:function(e,t){for(var a=e.data,o=0;o<a.length;o+=4){var n=a[o],i=a[o+1],l=a[o+2],s=.2126*n+.7152*i+.0722*l;a[o]=a[o+1]=a[o+2]=s}return e},brightness:function(e,t){for(var a=e.data,o=0;o<a.length;o+=4)a[o]+=t,a[o+1]+=t,a[o+2]+=t;return e},threshold:function(e,t){for(var a=e.data,o=0;o<a.length;o+=4){var n=a[o],i=a[o+1],l=a[o+2],s=.2126*n+.7152*i+.0722*l>=t?255:0;a[o]=a[o+1]=a[o+2]=s}return e},invert:function(e,t){for(var a=e.data,o=0;o<a.length;o+=4)a[o]=a[o],a[o+1]=255-a[o+1],a[o+2]=255-a[o+2];return e},contrast:function(e,t,a){for(var o=e.data,n=259*(t+255)/(255*(259-t)),i=0;i<o.length;i+=4)o[i]=n*(o[i]-128)+128,o[i+1]=n*(o[i+1]-128)+128,o[i+2]=n*(o[i+2]-128)+128;return e},createImageData:function(e,t){var a=document.createElement("canvas"),o=a.getContext("2d");return o.createImageData(e,t)},convolute:function(e,t,a){for(var o=Math.round(Math.sqrt(t.length)),n=Math.floor(o/2),i=e.data,l=e.width,s=e.height,r=l,c=s,u=Filter.createImageData(r,c),d=u.data,g=a?1:0,f=0;c>f;f+=1)for(var h=0;r>h;h+=1){for(var v=f,b=h,m=4*(f*r+h),G=0,w=0,p=0,D=0,T=0;o>T;T+=1)for(var C=0;o>C;C+=1){var $=Math.min(s-1,Math.max(0,v+T-n)),y=Math.min(l-1,Math.max(0,b+C-n)),M=4*($*l+y),k=t[T*o+C];G+=i[M]*k,w+=i[M+1]*k,p+=i[M+2]*k,D+=i[M+3]*k}d[m]=G,d[m+1]=w,d[m+2]=p,d[m+3]=D+g*(255-D)}return u},types:function(){Filter.gaussian=[6.7e-7,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,6.7e-7,2292e-8,78634e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,6.7e-7,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,6.7e-7]}},Canvas={init:function(){Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.uploaderLink=$("a#previewerLink"),Global.canvas.width=850,Global.canvas.height=850,Global.video.addEventListener("loadedToolsdata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("canplaythrough",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("loadeddata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("loadedmetadata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),window.localMediaStream||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL,navigator.getUserMedia(Global.videoSettings,function(e){Global.video.src=window.URL.createObjectURL(e),window.localMediaStream=e,Canvas.resizeCanvas(),Tools.cancel(),Canvas.feed(),Tools.activate("camchoice")},Tools.onCameraFail))},stopCam:function(){"use strict";var e=document.querySelector("video");if(null!==e){e.src=null;try{window.localMediaStream.stop()}catch(t){}window.localMediaStream=null,e.load()}return!0},feed:function(){function e(){Global.video.videoHeight>Global.video.videoWidth?(Global.sourceX=0,Global.sourceY=(Global.video.videoHeight-Global.video.videoWidth)/2,Global.sourceWidth=Global.video.videoWidth,Global.sourceHeight=Global.video.videoWidth,Tools.loading("stop"),clearInterval(window.feedTimer)):Global.video.videoHeight<Global.video.videoWidth&&(Global.sourceX=(Global.video.videoWidth-Global.video.videoHeight)/2,Global.sourceY=0,Global.sourceWidth=Global.video.videoHeight,Global.sourceHeight=Global.video.videoHeight,Tools.loading("stop"),clearInterval(window.feedTimer))}function t(){Global.ctx.drawImage(Global.video,Global.sourceX,Global.sourceY,Global.sourceWidth,Global.sourceHeight,Global.destX,Global.destY,Global.destWidth,Global.destHeight)}window.localMediaStream&&(window.snapInterval&&clearInterval(window.snapInterval),$("canvas").attr("videoLive","on"),window.feedTimer||(window.feedTimer=setInterval(e,50)),Global.destWidth=Global.canvas.width,Global.destHeight=Global.canvas.height,Global.ctx=Global.canvas.getContext("2d"),window.snapInterval=setInterval(t,40))},freezer:function(){"on"===$("canvas").attr("videoLive")&&(clearInterval(window.snapInterval),$(this).attr("videoLive","off"))},releaser:function(){$(".active").hasClass("cam")?(Canvas.feed(),$("canvas").attr("videoLive","on")):Global.ctx.clearRect(0,0,Global.canvas.width,Global.canvas.height)},transformCoordinate:function(e){switch(e){case 2:case"top-left":ctx.save(),ctx.translate(width,0),ctx.scale(-1,1);break;case 3:case"bottom-right":Canvas.rotate(180);break;case 4:case"bottom-left":ctx.save(),ctx.translate(0,height),ctx.scale(1,-1);break;case 5:case"left-top":ctx.save(),ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:case"right-top":Canvas.rotate(90);break;case 7:case"right-bottom":ctx.save(),ctx.rotate(.5*Math.PI),ctx.translate(width,-height),ctx.scale(-1,1);break;case 8:case"left-bottom":Canvas.rotate(-90)}},drawImageIOSFix:function(e,t,a,o,n,i,l,s,r,c){function u(e){var t=(e.naturalWidth,e.naturalHeight);this.canvas.width=1,this.canvas.height=t,this.ctx.drawImage(e,0,0);for(var a=this.ctx.getImageData(0,0,1,t).data,o=0,n=t,i=t;i>o;){var l=a[4*(i-1)+3];0===l?n=i:o=i,i=n+o>>1}var s=i/t;return 0===s?1:s}this.canvas=document.createElement("canvas"),this.ctx=canvas.getContext("2d");var d=u(t);Canvas.transformCoordinate(Tools.exif("orientation")),e.drawImage(t,a*d,o*d,n*d,i*d,l,s,r,c);t.naturalWidth,t.naturalHeight},fromImage:function(e){Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.file?(window.localMediaStream&&(clearInterval(window.snapInterval),Canvas.freezer()),Global.file=e.target.files[0],Global.imageObj.onload=function(){Tools.exif(),Global.canvas.width=850,Global.canvas.height=850,Global.sourceX=0,Global.sourceY=0,Global.sourceWidth=this.width,Global.sourceHeight=this.height,this.height>this.width?(Global.heightFactor=1,Global.widthFactor=this.width/this.height,Global.widthOffset=(Global.canvas.width-this.width)/2,Global.heightOffset=0):this.height<this.width?(Global.heightOffset=(Global.canvas.height-this.height)/2,Global.widthOffset=0,Global.heightFactor=this.height/this.width,Global.widthFactor=1):(Global.heightOffset=0,Global.widthOffset=0,Global.heightFactor=1,Global.widthFactor=1),Global.destWidth=Global.canvas.width*Global.widthFactor,Global.destHeight=Global.canvas.height*Global.heightFactor,Global.widthOffset=(Global.canvas.width-Global.destWidth)/2,Global.heightOffset=(Global.canvas.height-Global.destHeight)/2,Global.ctx.drawImage(this,Global.sourceX,Global.sourceY,Global.sourceWidth,Global.sourceHeight,Global.destX++ +Global.widthOffset,Global.destY++ +Global.heightOffset,Global.destWidth,Global.destHeight)},Global.imageObj||(Global.imageObj=new Image),Global.imageObj.src=window.URL.createObjectURL(Global.file)):Tools.cancel()},resizeCanvas:function(){Global.previewH=window.innerHeight,Global.previewW=window.innerWidth;var e=Global.startWindowHeight-Global.previewH;e>=36&&45>=e?$("footer").css({bottom:!1,top:"30px"}):$("footer").css({bottom:"60px",top:!1}),e=null,Global.previewH>Global.previewW?(Global.previewW>=850&&(Global.previewW=850),$(Global.canvas).css({width:Global.previewW+"px",height:Global.previewW+"px"})):(Global.previewW>=850&&Global.previewH>=920&&(Global.previewH=1700),$(Global.canvas).css({width:Global.previewH/1.5+"px",height:Global.previewH/1.5+"px"}))},filters:function(){"use strict";$(".filter.contrast").click(function(){Tools.loading("start","Processing Contrast."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.contrast(Global.imageData,20),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.BW").click(function(){Tools.loading("start","Processing Black&White."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.grayscale(Global.imageData),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.brighten").click(function(){Tools.loading("start","Processing Lighten."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.darken").click(function(){Tools.loading("start","Processing Darken."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,-5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.sharpen").click(function(){Tools.loading("start","Processing Sharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,[0,-1,0,-1,5,-1,0,-1,0]),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.blur").click(function(){Tools.loading("start","Processing Blur."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian,4),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.laplace").click(function(){Tools.loading("start","Processing Unsharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian),Global.iData2=Filter.convolute(Global.iData,Filter.gaussian),Global.iData3=Filter.convolute(Global.iData2,[-1,-2,-1,-2,13,-2,-1,-2,-1]),Global.ctx.putImageData(Global.iData3,0,0),Global.iData=null,Global.iData2=null,Global.iData3=null,Global.imageData=null},50),Tools.loading("stop")}),$("#clockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(90)},50),Tools.loading("stop")}),$("#counterclockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(-90)},50),Tools.loading("stop")})},rotate:function(e){var t=850,a=850;Global.tmpCanvas=new Image,Global.tmpCanvas.src=Global.canvas.toDataURL("image/png"),Global.tmpCanvas.onload=function(){Global.ctx.save(),Global.ctx.clearRect(0,0,Global.canvas.width,Global.canvas.height),Global.ctx.translate(Global.canvas.width/2,Global.canvas.height/2),Global.ctx.rotate(e*Math.PI/180),Global.ctx.drawImage(Global.tmpCanvas,-t/2,-a/2,t,a),Global.tmpCanvas=null,Global.ctx.restore()}},shove:function(){},crop:function(){},save:function(){Tools.loading(!0);var e=Global.canvas.toDataURL("image/png");window.location.download="test.png",window.location.href=e,e=null}};!function(){for(var e=0,t=["webkit","moz"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){
var o=(new Date).getTime(),n=Math.max(0,16-(o-e)),i=window.setTimeout(function(){t(o+n)},n);return e=o+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e,t){"use strict";var a=function(e,t,a){var o;return function(){function n(){a||e.apply(i,l),o=null}var i=this,l=arguments;o?clearTimeout(o):a&&e.apply(i,l),o=setTimeout(n,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),$(document).ready(function(){"use strict";$(window).smartresize(function(){setTimeout(function(){Canvas.resizeCanvas()},500)}),$("#camera,#camchoice").click(function(){function e(){Global.localMediaStream&&(clearTimeout(window.turnOnCamera),clearTimeout(window.cameraProblems),clearInterval(window.cameraInterval))}Tools.loading(!0),window.turnOnCamera=setTimeout(function(){$("#load").is(":visible")},5e3),window.cameraProblems=setTimeout(function(){$("#load").is(":visible")&&$("#nativeFile .fa").addClass("oneblink")},3e4),Canvas.init(),window.cameraInterval=setInterval(e,1e3)}),$("#nativeFile,#filechoice").click(function(){$("input#filechooser").trigger("click")}),$("input#filechooser").on("click",function(){function e(){Global.file&&(Tools.loading("stop"),clearInterval(window.fileInterval))}setTimeout(function(){Global.file||($("input#filechooser").attr("capture","camera").removeClass("hidden"),clearInterval(window.fileInterval))},15e3),window.fileInterval=setInterval(e,100)}).off("change").on("change",function(e){Global.file=this.files[0],Global.file&&(Tools.isImage(Global.file.type)===!0?(Canvas.fromImage(e),Tools.activate("filechoice"),$(".step1").hide(),$(".step3").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500)):setTimeout(function(){window.location.reload(!0)},3e3))}),$("#accept.action,canvas").click(function(){Tools.flash(),$(".step1").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500),Canvas.freezer()}),$("#cancel").click(function(){$(".step2").hide(),$(".step1").fadeIn(500),$(".step3").hide(),Canvas.releaser()}),$("#settings span.trigger").click(function(){$(".step3").hasClass("hidden")?($(".step3").hide().removeClass("hidden").fadeIn(500),$("#settings i.fa-stack-2x").addClass("fa-circle"),$("#settings i.fa-stack-1x").addClass("white")):($(".step3").fadeOut(250).addClass("hidden"),$("#settings .trigger").blur(),$("#settings .fa-stack-2x").removeClass("fa-circle"),$("#settings .fa-stack-1x").removeClass("white"))}),$(".step3 button").click(function(){$("#settings .trigger").click()}),$("#upload").bind("click",function(e){$(".step2").addClass("hidden"),Canvas.save(),$("#cancel").click()}),$(".filter.contrast").click(function(){Tools.loading("start","Processing Contrast."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.contrast(Global.imageData,20),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.BW").click(function(){Tools.loading("start","Processing Black&White."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.grayscale(Global.imageData),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.brighten").click(function(){Tools.loading("start","Processing Lighten."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.darken").click(function(){Tools.loading("start","Processing Darken."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,-5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.sharpen").click(function(){Tools.loading("start","Processing Sharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,[0,-1,0,-1,5,-1,0,-1,0]),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.blur").click(function(){Tools.loading("start","Processing Blur."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian,4),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.laplace").click(function(){Tools.loading("start","Processing Unsharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian),Global.iData2=Filter.convolute(Global.iData,Filter.gaussian),Global.iData3=Filter.convolute(Global.iData2,[-1,-2,-1,-2,13,-2,-1,-2,-1]),Global.ctx.putImageData(Global.iData3,0,0),Global.iData=null,Global.iData2=null,Global.iData3=null,Global.imageData=null},50),Tools.loading("stop")}),$("#clockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(90)},50),Tools.loading("stop")}),$("#counterclockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(-90)},50),Tools.loading("stop")})});