/**
 * antimeta-sideloader - A standalone Metadata scrubber and Picture App.
 * @version v0.0.1
 * @link 
 * @license 
 */
(function(){("undefined"!=typeof exports&&null!==exports?exports:this).ExifReader=function(){function e(){var e=this;this._getTagValueAt={1:function(t){return e._getByteAt(t)},2:function(t){return e._getAsciiAt(t)},3:function(t){return e._getShortAt(t)},4:function(t){return e._getLongAt(t)},5:function(t){return e._getRationalAt(t)},7:function(t){return e._getUndefinedAt(t)},9:function(t){return e._getSlongAt(t)},10:function(t){return e._getSrationalAt(t)}},this._tiffHeaderOffset=0}return e.prototype._MIN_DATA_BUFFER_LENGTH=2,e.prototype._JPEG_ID_SIZE=2,e.prototype._JPEG_ID=65496,e.prototype._APP_MARKER_SIZE=2,e.prototype._APP0_MARKER=65504,e.prototype._APP1_MARKER=65505,e.prototype._APP15_MARKER=65519,e.prototype._APP_ID_OFFSET=4,e.prototype._BYTES_Exif=1165519206,e.prototype._TIFF_HEADER_OFFSET=10,e.prototype._BYTE_ORDER_BIG_ENDIAN=18761,e.prototype._BYTE_ORDER_LITTLE_ENDIAN=19789,e.prototype.load=function(e){return this.loadView(new DataView(e))},e.prototype.loadView=function(e){return this._dataView=e,this._tags={},this._checkImageHeader(),this._readTags()},e.prototype._checkImageHeader=function(){var e;if(e=this._dataView,e.byteLength<this._MIN_DATA_BUFFER_LENGTH||e.getUint16(0,!1)!==this._JPEG_ID)throw new Error("Invalid image format");if(this._parseAppMarkers(e),!this._hasExifData())throw new Error("No Exif data")},e.prototype._parseAppMarkers=function(e){var t,a,n;for(t=this._JPEG_ID_SIZE,n=[];;){if(e.byteLength<t+this._APP_ID_OFFSET+5)break;if(this._isApp1ExifMarker(e,t))a=e.getUint16(t+this._APP_MARKER_SIZE,!1),this._tiffHeaderOffset=t+this._TIFF_HEADER_OFFSET;else{if(!this._isAppMarker(e,t))break;a=e.getUint16(t+this._APP_MARKER_SIZE,!1)}n.push(t+=this._APP_MARKER_SIZE+a)}return n},e.prototype._isApp1ExifMarker=function(e,t){return e.getUint16(t,!1)===this._APP1_MARKER&&e.getUint32(t+this._APP_ID_OFFSET,!1)===this._BYTES_Exif&&0===e.getUint8(t+this._APP_ID_OFFSET+4,!1)},e.prototype._isAppMarker=function(e,t){var a;return a=e.getUint16(t,!1),a>=this._APP0_MARKER&&a<=this._APP15_MARKER},e.prototype._hasExifData=function(){return 0!==this._tiffHeaderOffset},e.prototype._readTags=function(){return this._setByteOrder(),this._read0thIfd(),this._readExifIfd(),this._readGpsIfd(),this._readInteroperabilityIfd()},e.prototype._setByteOrder=function(){if(this._dataView.getUint16(this._tiffHeaderOffset)===this._BYTE_ORDER_BIG_ENDIAN)return this._littleEndian=!0;if(this._dataView.getUint16(this._tiffHeaderOffset)===this._BYTE_ORDER_LITTLE_ENDIAN)return this._littleEndian=!1;throw new Error("Illegal byte order value. Faulty image.")},e.prototype._read0thIfd=function(){var e;return e=this._getIfdOffset(),this._readIfd("0th",e)},e.prototype._getIfdOffset=function(){return this._tiffHeaderOffset+this._getLongAt(this._tiffHeaderOffset+4)},e.prototype._readExifIfd=function(){var e;return null!=this._tags["Exif IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["Exif IFD Pointer"].value,this._readIfd("exif",e)):void 0},e.prototype._readGpsIfd=function(){var e;return null!=this._tags["GPS Info IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["GPS Info IFD Pointer"].value,this._readIfd("gps",e)):void 0},e.prototype._readInteroperabilityIfd=function(){var e;return null!=this._tags["Interoperability IFD Pointer"]?(e=this._tiffHeaderOffset+this._tags["Interoperability IFD Pointer"].value,this._readIfd("interoperability",e)):void 0},e.prototype._readIfd=function(e,t){var a,n,i,o,r;for(n=this._getShortAt(t),t+=2,r=[],a=o=0;n>=0?n>o:o>n;a=n>=0?++o:--o)i=this._readTag(e,t),this._tags[i.name]={value:i.value,description:i.description},r.push(t+=12);return r},e.prototype._readTag=function(e,t){var a,n,i,o,r,l,s;return a=this._getShortAt(t),r=this._getShortAt(t+2),n=this._getLongAt(t+4),this._typeSizes[r]*n<=4?l=this._getTagValue(t+8,r,n):(s=this._getLongAt(t+8),l=this._getTagValue(this._tiffHeaderOffset+s,r,n)),r===this._tagTypes.ASCII&&(l=this._splitNullSeparatedAsciiString(l)),null!=this._tagNames[e][a]?(null!=this._tagNames[e][a].name&&null!=this._tagNames[e][a].description?(o=this._tagNames[e][a].name,i=this._tagNames[e][a].description(l)):(o=this._tagNames[e][a],i=l instanceof Array?l.join(", "):l),{name:o,value:l,description:i}):{name:"undefined-"+a,value:l,description:l}},e.prototype._getTagValue=function(e,t,a){var n,i,o;return i=function(){var i,r;for(r=[],o=i=0;a>=0?a>i:i>a;o=a>=0?++i:--i)n=this._getTagValueAt[t](e),e+=this._typeSizes[t],r.push(n);return r}.call(this),1===i.length?i=i[0]:t===this._tagTypes.ASCII&&(i=this._getAsciiValue(i)),i},e.prototype._getAsciiValue=function(e){var t,a;return a=function(){var a,n,i;for(i=[],a=0,n=e.length;n>a;a++)t=e[a],i.push(String.fromCharCode(t));return i}()},e.prototype._getByteAt=function(e){return this._dataView.getUint8(e)},e.prototype._getAsciiAt=function(e){return this._dataView.getUint8(e)},e.prototype._getShortAt=function(e){return this._dataView.getUint16(e,this._littleEndian)},e.prototype._getLongAt=function(e){return this._dataView.getUint32(e,this._littleEndian)},e.prototype._getRationalAt=function(e){return this._getLongAt(e)/this._getLongAt(e+4)},e.prototype._getUndefinedAt=function(e){return this._getByteAt(e)},e.prototype._getSlongAt=function(e){return this._dataView.getInt32(e,this._littleEndian)},e.prototype._getSrationalAt=function(e){return this._getSlongAt(e)/this._getSlongAt(e+4)},e.prototype._splitNullSeparatedAsciiString=function(e){var t,a,n,i,o;for(n=[],a=0,i=0,o=e.length;o>i;i++)t=e[i],"\x00"!==t?(null==n[a]&&(n[a]=""),n[a]+=t):a++;return n},e.prototype._typeSizes={1:1,2:1,3:2,4:4,5:8,7:1,9:4,10:8},e.prototype._tagTypes={BYTE:1,ASCII:2,SHORT:3,LONG:4,RATIONAL:5,UNDEFINED:7,SLONG:9,SRATIONAL:10},e.prototype._tagNames={"0th":{256:"ImageWidth",257:"ImageLength",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:{name:"Orientation",description:function(e){switch(e){case 1:return"top-left";case 2:return"top-right";case 3:return"bottom-right";case 4:return"bottom-left";case 5:return"left-top";case 6:return"right-top";case 7:return"right-bottom";case 8:return"left-bottom";default:return"Undefined"}}},277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:{name:"ResolutionUnit",description:function(e){switch(e){case 2:return"inches";case 3:return"centimeters";default:return"Unknown"}}},301:"TransferFunction",305:"Software",306:"DateTime",315:"Artist",318:"WhitePoint",319:"PrimaryChromaticities",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:{name:"YCbCrPositioning",description:function(e){switch(e){case 1:return"centered";case 2:return"co-sited";default:return"undefied "+e}}},532:"ReferenceBlackWhite",33432:{name:"Copyright",description:function(e){return e.join("; ")}},34665:"Exif IFD Pointer",34853:"GPS Info IFD Pointer"},exif:{33434:"ExposureTime",33437:"FNumber",34850:{name:"ExposureProgram",description:function(e){switch(e){case 0:return"Undefined";case 1:return"Manual";case 2:return"Normal program";case 3:return"Aperture priority";case 4:return"Shutter priority";case 5:return"Creative program";case 6:return"Action program";case 7:return"Portrait mode";case 8:return"Landscape mode";default:return"Unknown"}}},34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:{name:"OECF",description:function(e){return"[Raw OECF table data]"}},36864:{name:"ExifVersion",description:function(e){var t,a,n,i;for(a="",n=0,i=e.length;i>n;n++)t=e[n],a+=String.fromCharCode(t);return a}},36867:"DateTimeOriginal",36868:"DateTimeDigitized",37121:{name:"ComponentsConfiguration",description:function(e){var t,a,n,i;for(a="",n=0,i=e.length;i>n;n++)switch(t=e[n]){case 49:a+="Y";break;case 50:a+="Cb";break;case 51:a+="Cr";break;case 52:a+="R";break;case 53:a+="G";break;case 54:a+="B"}return a}},37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBiasValue",37381:"MaxApertureValue",37382:"SubjectDistance",37383:{name:"MeteringMode",description:function(e){switch(e){case 1:return"Average";case 2:return"CenterWeightedAverage";case 3:return"Spot";case 4:return"MultiSpot";case 5:return"Pattern";case 6:return"Partial";case 255:return"Other";default:return"Unknown"}}},37384:{name:"LightSource",description:function(e){switch(e){case 1:return"Daylight";case 2:return"Fluorescent";case 3:return"Tungsten (incandescent light)";case 4:return"Flash";case 9:return"Fine weather";case 10:return"Cloudy weather";case 11:return"Shade";case 12:return"Daylight fluorescent (D 5700 – 7100K)";case 13:return"Day white fluorescent (N 4600 – 5400K)";case 14:return"Cool white fluorescent (W 3900 – 4500K)";case 15:return"White fluorescent (WW 3200 – 3700K)";case 17:return"Standard light A";case 18:return"Standard light B";case 19:return"Standard light C";case 20:return"D55";case 21:return"D65";case 22:return"D75";case 23:return"D50";case 24:return"ISO studio tungsten";case 255:return"Other light source";default:return"Unknown"}}},37385:{name:"Flash",description:function(e){switch(e){case 0:return"Flash did not fire";case 1:return"Flash fired";case 5:return"Strobe return light not detected";case 7:return"Strobe return light detected";case 9:return"Flash fired, compulsory flash mode";case 13:return"Flash fired, compulsory flash mode, return light not detected";case 15:return"Flash fired, compulsory flash mode, return light detected";case 16:return"Flash did not fire, compulsory flash mode";case 24:return"Flash did not fire, auto mode";case 25:return"Flash fired, auto mode";case 29:return"Flash fired, auto mode, return light not detected";case 31:return"Flash fired, auto mode, return light detected";case 32:return"No flash function";case 65:return"Flash fired, red-eye reduction mode";case 69:return"Flash fired, red-eye reduction mode, return light not detected";case 71:return"Flash fired, red-eye reduction mode, return light detected";case 73:return"Flash fired, compulsory flash mode, red-eye reduction mode";case 77:return"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected";case 79:return"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected";case 89:return"Flash fired, auto mode, red-eye reduction mode";case 93:return"Flash fired, auto mode, return light not detected, red-eye reduction mode";case 95:return"Flash fired, auto mode, return light detected, red-eye reduction mode";default:return"Unknown"}}},37386:"FocalLength",37396:{name:"SubjectArea",description:function(e){switch(e.length){case 2:return"Location; X: "+e[0]+", Y: "+e[1];case 3:return"Circle; X: "+e[0]+", Y: "+e[1]+", diameter: "+e[2];case 4:return"Rectangle; X: "+e[0]+", Y: "+e[1]+", width: "+e[2]+", height: "+e[3];default:return"Unknown"}}},37500:{name:"MakerNote",description:function(e){return"[Raw maker note data]"}},37510:{name:"UserComment",description:function(e){switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",40960:{name:"FlashpixVersion",description:function(e){var t,a,n,i;for(a="",n=0,i=e.length;i>n;n++)t=e[n],a+=String.fromCharCode(t);return a}},40961:{name:"ColorSpace",description:function(e){switch(e){case 1:return"sRGB";case 65535:return"Uncalibrated";default:return"Unknown"}}},40962:"PixelXDimension",40963:"PixelYDimension",40964:"RelatedSoundFile",40965:"Interoperability IFD Pointer",41483:"FlashEnergy",41484:{name:"SpatialFrequencyResponse",description:function(e){return"[Raw SFR table data]"}},41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:{name:"FocalPlaneResolutionUnit",description:function(e){switch(e){case 2:return"inches";case 3:return"centimeters";default:return"Unknown"}}},41492:{name:"SubjectLocation",description:function(e){return"X: "+e[0]+", Y: "+e[1]}},41493:"ExposureIndex",41495:{name:"SensingMethod",description:function(e){switch(e){case 1:return"Undefined";case 2:return"One-chip color area sensor";case 3:return"Two-chip color area sensor";case 4:return"Three-chip color area sensor";case 5:return"Color sequential area sensor";case 7:return"Trilinear sensor";case 8:return"Color sequential linear sensor";default:return"Unknown"}}},41728:{name:"FileSource",description:function(e){switch(e){case 3:return"DSC";default:return"Unknown"}}},41729:{name:"SceneType",description:function(e){switch(e){case 1:return"A directly photographed image";default:return"Unknown"}}},41730:{name:"CFAPattern",description:function(e){return"[Raw CFA pattern table data]"}},41985:{name:"CustomRendered",description:function(e){switch(e){case 0:return"Normal process";case 1:return"Custom process";default:return"Unknown"}}},41986:{name:"ExposureMode",description:function(e){switch(e){case 0:return"Auto exposure";case 1:return"Manual exposure";case 2:return"Auto bracket";default:return"Unknown"}}},41987:{name:"WhiteBalance",description:function(e){switch(e){case 0:return"Auto white balance";case 1:return"Manual white balance";default:return"Unknown"}}},41988:{name:"DigitalZoomRatio",description:function(e){switch(e){case 0:return"Digital zoom was not used";default:return e}}},41989:{name:"FocalLengthIn35mmFilm",description:function(e){switch(e){case 0:return"Unknown";default:return e}}},41990:{name:"SceneCaptureType",description:function(e){switch(e){case 0:return"Standard";case 1:return"Landscape";case 2:return"Portrait";case 3:return"Night scene";default:return"Unknown"}}},41991:{name:"GainControl",description:function(e){switch(e){case 0:return"None";case 1:return"Low gain up";case 2:return"High gain up";case 3:return"Low gain down";case 4:return"High gain down";default:return"Unknown"}}},41992:{name:"Contrast",description:function(e){switch(e){case 0:return"Normal";case 1:return"Soft";case 2:return"Hard";default:return"Unknown"}}},41993:{name:"Saturation",description:function(e){switch(e){case 0:return"Normal";case 1:return"Low saturation";case 2:return"High saturation";default:return"Unknown"}}},41994:{name:"Sharpness",description:function(e){switch(e){case 0:return"Normal";case 1:return"Soft";case 2:return"Hard";default:return"Unknown"}}},41995:{name:"DeviceSettingDescription",description:function(e){return"[Raw device settings table data]"}},41996:{name:"SubjectDistanceRange",description:function(e){switch(e){case 1:return"Macro";case 2:return"Close view";case 3:return"Distant view";default:return"Unknown"}}},42016:"ImageUniqueID"},gps:{0:{name:"GPSVersionID",description:function(e){var t,a;return e[0]===(t=e[1])&&2===t&&e[2]===(a=e[3])&&0===a?"Version 2.2":"Unknown"}},1:{name:"GPSLatitudeRef",description:function(e){switch(e.join("")){case"N":return"North latitude";case"S":return"South latitude";default:return"Unknown"}}},2:{name:"GPSLatitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},3:{name:"GPSLongitudeRef",description:function(e){switch(e.join("")){case"E":return"East longitude";case"W":return"West longitude";default:return"Unknown"}}},4:{name:"GPSLongitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},5:{name:"GPSAltitudeRef",description:function(e){switch(e){case 0:return"Sea level";case 1:return"Sea level reference (negative value)";default:return"Unknown"}}},6:{name:"GPSAltitude",description:function(e){return e+" m"}},7:{name:"GPSTimeStamp",description:function(e){var t;return t=function(e){var t;return function(){var a,n,i;for(i=[],t=a=0,n=2-(""+Math.floor(e)).length;n>=0?n>a:a>n;t=n>=0?++a:--a)i.push("0");return i}()+e},e.map(t).join(":")}},8:"GPSSatellites",9:{name:"GPSStatus",description:function(e){switch(e.join("")){case"A":return"Measurement in progress";case"V":return"Measurement Interoperability";default:return"Unknown"}}},10:{name:"GPSMeasureMode",description:function(e){switch(e.join("")){case"2":return"2-dimensional measurement";case"3":return"3-dimensional measurement";default:return"Unknown"}}},11:"GPSDOP",12:{name:"GPSSpeedRef",description:function(e){switch(e.join("")){case"K":return"Kilometers per hour";case"M":return"Miles per hour";case"N":return"Knots";default:return"Unknown"}}},13:"GPSSpeed",14:{name:"GPSTrackRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},15:"GPSTrack",16:{name:"GPSImgDirectionRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},17:"GPSImgDirection",18:"GPSMapDatum",19:{name:"GPSDestLatitudeRef",description:function(e){switch(e.join("")){case"N":return"North latitude";case"S":return"South latitude";default:return"Unknown"}}},20:{name:"GPSDestLatitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},21:{name:"GPSDestLongitudeRef",description:function(e){switch(e.join("")){case"E":return"East longitude";case"W":return"West longitude";default:return"Unknown"}}},22:{name:"GPSDestLongitude",description:function(e){return e[0]+e[1]/60+e[2]/3600}},23:{name:"GPSDestBearingRef",description:function(e){switch(e.join("")){case"T":return"True direction";case"M":return"Magnetic direction";default:return"Unknown"}}},24:"GPSDestBearing",25:{name:"GPSDestDistanceRef",description:function(e){switch(e.join("")){case"K":return"Kilometers";case"M":return"Miles";case"N":return"Knots";default:return"Unknown"}}},26:"GPSDestDistance",27:{name:"GPSProcessingMethod",description:function(e){switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},28:{name:"GPSAreaInformation",description:function(e){switch(e.slice(0,8).map(function(e){return String.fromCharCode(e)}).join("")){case"ASCII\x00\x00\x00":return e.slice(8,e.length).map(function(e){return String.fromCharCode(e)}).join("");case"JIS\x00\x00\x00\x00\x00":return"[JIS encoded text]";case"UNICODE\x00":return"[Unicode encoded text]";case"\x00\x00\x00\x00\x00\x00\x00\x00":return"[Undefined encoding]"}}},29:"GPSDateStamp",30:{name:"GPSDifferential",description:function(e){switch(e){case 0:return"Measurement without differential correction";case 1:return"Differential correction applied";default:return"Unknown"}}}},interoperability:{1:"InteroperabilityIndex",2:"UnknownInteroperabilityTag0x0002",4097:"UnknownInteroperabilityTag0x1001",4098:"UnknownInteroperabilityTag0x1002"}},e.prototype.getTagValue=function(e){return null!=this._tags[e]?this._tags[e].value:void 0},e.prototype.getTagDescription=function(e){return null!=this._tags[e]?this._tags[e].description:void 0},e.prototype.getAllTags=function(){return this._tags},e}()}).call(this),function(){"use strict";angular.module("antimeta",["ui.bootstrap","ngRoute","ngAnimate","ngTouch","antimeta.controllers"]).config(["$routeProvider","$locationProvider","$animateProvider",function(e,t,a){a.classNameFilter(/animate-/),t.html5Mode(!0),e.when("/",{templateUrl:"/index.html",controller:"Upload"}),e.otherwise({redirectTo:"/"})}]).run(["$route","$rootScope","$location",function(e,t,a){var n=a.path;a.path=function(i,o){if(o===!1)var r=e.current,l=t.$on("$locationChangeSuccess",function(){e.current=r,l()});return n.apply(a,[i])}}])}(),function(){"use strict";angular.module("antimeta.controllers",["ngAnimate"]).controller("Upload",["$scope","$q","$http",function(e,t,a){e.someData=null,e.messageCenter={message:"Make a photo or choose an image file."};t.defer();e.setMessage=function(t,a,n){clearTimeout(window.messageTimer),n||(n="label-default"),e.$apply(function(){e.messageCenter=null,e.messageCenter={message:t,"class":n}}),a>-1&&(window.messageTimer=setTimeout(function(){e.$apply(function(){e.messageCenter=null})},a))},window.setMessage=function(t,a,n){e.setMessage(t,a,n)},Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.uploaderLink=$("a#previewerLink"),Filter.types(),Canvas.init(),Canvas.resizeCanvas(),Canvas.filters(),MainInterface.upload()}]).controller("About",["$scope",function(e){}])}(),function(){function e(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}function t(e,t){void 0===Date.prototype[e]&&(Date.prototype[e]=t)}var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=["January","February","March","April","May","June","July","August","September","October","November","December"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r={su:0,sun:0,sunday:0,mo:1,mon:1,monday:1,tu:2,tue:2,tuesday:2,we:3,wed:3,wednesday:3,th:4,thu:4,thursday:4,fr:5,fri:5,friday:5,sa:6,sat:6,saturday:6},l=n.concat(a),s=["su","sun","sunday","mo","mon","monday","tu","tue","tuesday","we","wed","wednesday","th","thu","thursday","fr","fri","friday","sa","sat","saturday"],c={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},u=[31,28,31,30,31,30,31,31,30,31,30,31],d=function(e){return e.match(/^(\d+)$/)?!0:!1},f=function(e,t,a,n){for(var i=n;i>=a;i--){var o=e.substring(t,t+i);if(o.length<a)return null;if(d(o))return o}return null},h=Date.parse,g=function(e,t){e+="",t+="";for(var a,n,i=0,o=0,r="",c="",u=new Date,d=u.getYear(),h=u.getMonth()+1,g=1,m=0,p=0,v=0,b="";o<t.length;){for(r=t.charAt(o),c="";t.charAt(o)===r&&o<t.length;)c+=t.charAt(o++);if("yyyy"===c||"yy"===c||"y"===c){if("yyyy"===c&&(a=4,n=4),"yy"===c&&(a=2,n=2),"y"===c&&(a=2,n=4),d=f(e,i,a,n),null===d)return 0/0;i+=d.length,2===d.length&&(d=d>70?1900+(d-0):2e3+(d-0))}else if("MMM"===c||"NNN"===c){h=0;for(var w=0;w<l.length;w++){var G=l[w];if(e.substring(i,i+G.length).toLowerCase()===G.toLowerCase()&&("MMM"===c||"NNN"===c&&w>11)){h=w+1,h>12&&(h-=12),i+=G.length;break}}if(1>h||h>12)return 0/0}else if("EE"===c||"E"===c)for(var D=0;D<s.length;D++){var T=s[D];if(e.substring(i,i+T.length).toLowerCase()===T.toLowerCase()){i+=T.length;break}}else if("MM"===c||"M"===c){if(h=f(e,i,c.length,2),null===h||1>h||h>12)return 0/0;i+=h.length}else if("dd"===c||"d"===c){if(g=f(e,i,c.length,2),null===g||1>g||g>31)return 0/0;i+=g.length}else if("hh"===c||"h"===c){if(m=f(e,i,c.length,2),null===m||1>m||m>12)return 0/0;i+=m.length}else if("HH"===c||"H"===c){if(m=f(e,i,c.length,2),null===m||0>m||m>23)return 0/0;i+=m.length}else if("KK"===c||"K"===c){if(m=f(e,i,c.length,2),null===m||0>m||m>11)return 0/0;i+=m.length}else if("kk"===c||"k"===c){if(m=f(e,i,c.length,2),null===m||1>m||m>24)return 0/0;i+=m.length,m--}else if("mm"===c||"m"===c){if(p=f(e,i,c.length,2),null===p||0>p||p>59)return 0/0;i+=p.length}else if("ss"===c||"s"===c){if(v=f(e,i,c.length,2),null===v||0>v||v>59)return 0/0;i+=v.length}else if("a"===c){if("am"===e.substring(i,i+2).toLowerCase())b="AM";else{if("pm"!==e.substring(i,i+2).toLowerCase())return 0/0;b="PM"}i+=2}else{if(e.substring(i,i+c.length)!==c)return 0/0;i+=c.length}}if(i!==e.length)return 0/0;if(2===h)if(d%4===0&&d%100!==0||d%400===0){if(g>29)return 0/0}else if(g>28)return 0/0;if((4===h||6===h||9===h||11===h)&&g>30)return 0/0;12>m&&"PM"===b?m=m-0+12:m>11&&"AM"===b&&(m-=12);var y=new Date(d,h-1,g,m,p,v);return y.getTime()};Date.parse=function(e,t){if(t)return g(e,t);var a,n=h(e),i=0;return isNaN(n)&&(a=/^(\d{4}|[+\-]\d{6})-(\d{2})-(\d{2})(?:[T ](\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?))?/.exec(e))&&("Z"!==a[8]&&(i=60*+a[10]+ +a[11],"+"===a[9]&&(i=0-i)),a[7]=a[7]||"000",n=Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5]+i,+a[6],+a[7].substr(0,3))),n},Date.today=function(){return(new Date).clearTime()},Date.UTCtoday=function(){return(new Date).clearUTCTime()},Date.tomorrow=function(){return Date.today().add({days:1})},Date.UTCtomorrow=function(){return Date.UTCtoday().add({days:1})},Date.yesterday=function(){return Date.today().add({days:-1})},Date.UTCyesterday=function(){return Date.UTCtoday().add({days:-1})},Date.validateDay=function(e,t,a){var n=new Date(t,a,e);return n.getFullYear()===t&&n.getMonth()===a&&n.getDate()===e},Date.validateYear=function(e){return e>=0&&9999>=e},Date.validateSecond=function(e){return e>=0&&60>e},Date.validateMonth=function(e){return e>=0&&12>e},Date.validateMinute=function(e){return e>=0&&60>e},Date.validateMillisecond=function(e){return e>=0&&1e3>e},Date.validateHour=function(e){return e>=0&&24>e},Date.compare=function(e,t){return e.valueOf()<t.valueOf()?-1:e.valueOf()>t.valueOf()?1:0},Date.equals=function(e,t){return e.valueOf()===t.valueOf()},Date.getDayNumberFromName=function(e){return r[e.toLowerCase()]},Date.getMonthNumberFromName=function(e){return c[e.toLowerCase()]},Date.isLeapYear=function(e){return 29===new Date(e,1,29).getDate()},Date.getDaysInMonth=function(e,t){return 1===t?Date.isLeapYear(e)?29:28:u[t]},t("getMonthAbbr",function(){return a[this.getMonth()]}),t("getMonthName",function(){return n[this.getMonth()]}),t("getUTCOffset",function(){var t=e(Math.abs(this.getTimezoneOffset()/.6),4);return this.getTimezoneOffset()>0&&(t="-"+t),t}),t("toCLFString",function(){return e(this.getDate(),2)+"/"+this.getMonthAbbr()+"/"+this.getFullYear()+":"+e(this.getHours(),2)+":"+e(this.getMinutes(),2)+":"+e(this.getSeconds(),2)+" "+this.getUTCOffset()}),t("toYMD",function(t){return t="undefined"==typeof t?"-":t,this.getFullYear()+t+e(this.getMonth()+1,2)+t+e(this.getDate(),2)}),t("toDBString",function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1,2)+"-"+e(this.getUTCDate(),2)+" "+e(this.getUTCHours(),2)+":"+e(this.getUTCMinutes(),2)+":"+e(this.getUTCSeconds(),2)}),t("clearTime",function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this}),t("clearUTCTime",function(){return this.setUTCHours(0),this.setUTCMinutes(0),this.setUTCSeconds(0),this.setUTCMilliseconds(0),this}),t("add",function(e){return void 0!==e.milliseconds&&this.setMilliseconds(this.getMilliseconds()+e.milliseconds),void 0!==e.seconds&&this.setSeconds(this.getSeconds()+e.seconds),void 0!==e.minutes&&this.setMinutes(this.getMinutes()+e.minutes),void 0!==e.hours&&this.setHours(this.getHours()+e.hours),void 0!==e.days&&this.setDate(this.getDate()+e.days),void 0!==e.weeks&&this.setDate(this.getDate()+7*e.weeks),void 0!==e.months&&this.setMonth(this.getMonth()+e.months),void 0!==e.years&&this.setFullYear(this.getFullYear()+e.years),this}),t("addMilliseconds",function(e){return this.add({milliseconds:e})}),t("addSeconds",function(e){return this.add({seconds:e})}),t("addMinutes",function(e){return this.add({minutes:e})}),t("addHours",function(e){return this.add({hours:e})}),t("addDays",function(e){return this.add({days:e})}),t("addWeeks",function(e){return this.add({days:7*e})}),t("addMonths",function(e){return this.add({months:e})}),t("addYears",function(e){return this.add({years:e})}),t("setTimeToNow",function(){var e=new Date;this.setMilliseconds(e.getMilliseconds()),this.setSeconds(e.getSeconds()),this.setMinutes(e.getMinutes()),this.setHours(e.getHours())}),t("clone",function(){return new Date(this.valueOf())}),t("between",function(e,t){return this.valueOf()>=e.valueOf()&&this.valueOf()<=t.valueOf()}),t("compareTo",function(e){return Date.compare(this,e)}),t("equals",function(e){return Date.equals(this,e)}),t("isAfter",function(e){return e=e?e:new Date,this.compareTo(e)>0}),t("isBefore",function(e){return e=e?e:new Date,this.compareTo(e)<0}),t("getDaysBetween",function(e){return(e.clone().valueOf()-this.valueOf())/864e5|0}),t("getHoursBetween",function(e){return(e.clone().valueOf()-this.valueOf())/36e5|0}),t("getMinutesBetween",function(e){return(e.clone().valueOf()-this.valueOf())/6e4|0}),t("getSecondsBetween",function(e){return(e.clone().valueOf()-this.valueOf())/1e3|0}),t("getMillisecondsBetween",function(e){return e.clone().valueOf()-this.valueOf()|0}),t("getOrdinalNumber",function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1}),t("toFormat",function(e){return m(e,p(this))}),t("toUTCFormat",function(e){return m(e,v(this))});var m=function(e,t){var a,n,i,o=[e],r=function(e,t){for(var a,n,i,r=0,l=o.length,s=[];l>r;r++)if("string"==typeof o[r]){for(i=o[r].split(e),a=0,n=i.length-1;n>a;a++)s.push(i[a]),s.push([t]);s.push(i[n])}else s.push(o[r]);o=s};for(a in t)r(a,t[a]);for(i="",a=0,n=o.length;n>a;a++)i+="string"==typeof o[a]?o[a]:o[a][0];return o.join("")},p=function(t){var r=t.getHours()%12?t.getHours()%12:12;return{YYYY:t.getFullYear(),YY:String(t.getFullYear()).slice(-2),MMMM:n[t.getMonth()],MMM:a[t.getMonth()],MM:e(t.getMonth()+1,2),MI:e(t.getMinutes(),2),M:t.getMonth()+1,DDDD:o[t.getDay()],DDD:i[t.getDay()],DD:e(t.getDate(),2),D:t.getDate(),HH24:e(t.getHours(),2),HH:e(r,2),H:r,SS:e(t.getSeconds(),2),PP:t.getHours()>=12?"PM":"AM",P:t.getHours()>=12?"pm":"am",LL:e(t.getMilliseconds(),3)}},v=function(t){var r=t.getUTCHours()%12?t.getUTCHours()%12:12;return{YYYY:t.getUTCFullYear(),YY:String(t.getUTCFullYear()).slice(-2),MMMM:n[t.getUTCMonth()],MMM:a[t.getUTCMonth()],MM:e(t.getUTCMonth()+1,2),MI:e(t.getUTCMinutes(),2),M:t.getUTCMonth()+1,DDDD:o[t.getUTCDay()],DDD:i[t.getUTCDay()],DD:e(t.getUTCDate(),2),D:t.getUTCDate(),HH24:e(t.getUTCHours(),2),HH:e(r,2),H:r,SS:e(t.getUTCSeconds(),2),PP:t.getUTCHours()>=12?"PM":"AM",P:t.getUTCHours()>=12?"pm":"am",LL:e(t.getUTCMilliseconds(),3)}}}(),angular.module("antimeta.directives",[]).filter("toArray",function(){"use strict";return function(e){var t=[];return angular.forEach(e,function(e,a){e.offset!==!1&&t.push(e)}),t}}).directive("categories",function(){}).directive("whenScrolled",function(){"use strict";return function(e,t,a){var n=t[0],i=window.getComputedStyle(n),o=i.getPropertyValue("overflow-x");"scroll"===o?t.bind("scroll",function(){n.scrollLeft+n.offsetWidth>=n.scrollWidth-60&&e.$apply(a.whenScrolled)}):t.bind("scroll",function(){n.scrollTop+n.offsetHeight>=n.scrollHeight-60&&e.$apply(a.whenScrolled)})}}).directive("filterListView",function(){"use strict"}).directive("clickJacker",function(){"use strict";return function(e,t,a){t[0];$(t).bind("click",function(){e.$apply(a.clickJacker)})}});var MainInterface={menu:function(e){"use strict";var t,a;$(".nav a:last").hasClass("hidden")===!0&&$(".nav a:nth-last-of-type(2)").addClass("roundedBottom"),$(".openMenu").unbind("click").bind("click",function(){$(".nav a:nth-last-of-type(2)").hasClass("roundedBottom")===!0?$(".nav a:nth-last-of-type(2)").removeClass("roundedBottom"):$(".nav a:last").hasClass("hidden")===!0&&$(".nav a:nth-last-of-type(2)").addClass("roundedBottom"),$(".nav").toggle(100),$(this).blur()}),"autohide"===e?(t=window.setTimeout(function(){$(".openMenu,.nav").fadeOut(500),$("*").css("cursor","none")},5e3),$(document).on("mousemove","*",function(){$("*").css("cursor","auto")}).on("click","canvas",function(){$(".openMenu").fadeIn(500),window.setTimeout(t)}).on("mouseover",".nav",function(){window.clearTimeout(a),window.clearTimeout(t)}).on("mouseleave",".nav",function(){window.setTimeout(t),$(".nav").fadeOut(250)})):(a=window.setTimeout(function(){$(".nav").fadeOut(500)},5e3),$(document).on("mouseover",".nav",function(){window.clearTimeout(a),window.clearTimeout(t)}).on("mouseleave",".nav",function(){$(".nav").fadeOut(250),$("img.teampics").unbind("click").bind("click",function(){Global.NEWTEAMMATEcontributor_id=$(this).attr("ng-contributor_id"),$("img.teampics").removeClass("selectedForTeam"),$(this).addClass("selectedForTeam"),
Global.reference_image_id=$(this).attr("ng-reference_image_id")})})),$("a:not(.stayhere)").unbind("click").bind("click",function(e){e.preventDefault();var t=Canvas.stopCam(),a=$(this).attr("href"),n=window.setInterval(function(){t===!0&&(window.clearInterval(n),window.location.href=a)},250)}),$("a.stayhere").unbind("click").bind("click",function(e){e.preventDefault(),$("#allPics").toggleClass("hidden"),$(".nav").fadeOut(250)})},upload:function(){"use strict";function e(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}e()===!1?($("#camera,#camchoice").remove(),$("#accept").css("padding-right","50px")):$("#camera,#camchoice").click(function(){function e(){window.localMediaStream&&(clearTimeout(window.turnOnCamera),clearTimeout(window.cameraProblems),clearInterval(window.cameraInterval))}Tools.loading(!0),window.turnOnCamera=setTimeout(function(){$("#load").is(":visible")},5e3),window.cameraProblems=setTimeout(function(){$("#load").is(":visible")&&$("#nativeFile .fa").addClass("oneblink")},3e4),Canvas.init(),window.cameraInterval=setInterval(e,1e3)}),$(window).smartresize(function(){setTimeout(function(){Canvas.resizeCanvas()},500)}),$("#city").on("click",function(){$("#cityChooser").fadeIn()}),$("#nativeFile,#filechoice").click(function(){$("input#filechooser").trigger("click")}),$("input#filechooser").on("click",function(){function e(){Global.file&&(Tools.loading("stop"),clearInterval(window.fileInterval))}setTimeout(function(){Global.file||($("input#filechooser").attr("capture","camera").removeClass("hidden"),clearInterval(window.fileInterval))},15e3),window.fileInterval=setInterval(e,100)}).off("change").on("change",function(e){Global.file=this.files[0],Global.file&&(Tools.isImage(Global.file.type)===!0?(Canvas.fromImage(e),Tools.activate("filechoice"),$(".step1").hide(),$(".step3").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500)):setTimeout(function(){window.location.reload(!0)},3e3))}),$("#accept.action,canvas").click(function(){Tools.flash(),$(".step1").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500),Canvas.freezer()}),$("#cancel").click(function(){$(".step2").hide(),$(".step1").fadeIn(500),$(".step3").hide(),Canvas.releaser()}),$("#settings span.trigger").click(function(){$(".step3").hasClass("hidden")?($(".step3").hide().removeClass("hidden").fadeIn(500),$("#settings i.fa-stack-2x").addClass("fa-circle"),$("#settings i.fa-stack-1x").addClass("white")):($(".step3").fadeOut(250).addClass("hidden"),$("#settings .trigger").blur(),$("#settings .fa-stack-2x").removeClass("fa-circle"),$("#settings .fa-stack-1x").removeClass("white"))}),$(".step3 button").click(function(){$("#settings .trigger").click()}),$("#upload").bind("click",function(){$(".step2").addClass("hidden"),Canvas.upload()})}},Global={ns:null,video:document.querySelector("video"),canvas:document.querySelector("canvas#previewer"),ctx:null,videoSettings:{audio:!1,video:{mandatory:{minWidth:1920,minHeight:1080}}},localMediaStream:null,uploaderLink:$("a#previewerLink"),imageTypes:["image/png","image/x-apple-ios-png","image/x-png","image/jpeg","image/gif","image/bmp"],sourceX:null,sourceY:null,sourceWidth:null,sourceHeight:null,destWidth:null,destHeight:null,destX:0,destY:0,canvasWidth:850,canvasHeight:850,imageObj:new Image,imageData:null,iData:null,iData2:null,iData3:null,file:null,previewH:null,previewW:null,angleRotate:0,uploadLock:!1,logoLock:!1,videoFeedLock:!1,startWindowHeight:null,exif:null,EXIFlat:"Location Unknown",GPSlat:"Location Unknown",EXIFlong:"Location Unknown",GPSlong:"Location Unknown",GPSaccuracy:null,flash:$("#flash"),user:null,team_id:null},Tools={getLat:function(){return"Location Unknown"!=Global.EXIFlat?Global.EXIFlat:"Location Unknown"!=Global.GPSlat?Global.GPSlat:void 0==Global.city?53.5555252:"Hamburg"===Global.city?53.5555252:"Tallinn"===Global.city?59.443764:"Paris"===Global.city?48.8588589:void 0},getLong:function(){return"Location Unknown"!==Global.EXIFlong?Global.EXIFlong:"Location Unknown"!==Global.GPSlong?Global.GPSlong:void 0===Global.city?9.98361312:"Hamburg"===Global.city?9.98361312:"Tallinn"===Global.city?24.779466:"Paris"===Global.city?2.3470599:void 0},exif:function(e){var t=new FileReader;t.onload=function(t){try{var a=new ExifReader;if(a.load(t.target.result),"orientation"===e){var n=a.getTagDescription("Orientation");return n}var i=a.getTagDescription("GPSLatitude"),o=a.getTagDescription("GPSLongitude");void 0!==i&&void 0!==o?(Global.EXIFlat=i,Global.EXIFlong=o,$("#city").text("Photo Location Data")):(Global.EXIFlat="Location Unknown",Global.EXIFlong="Location Unknown")}catch(r){}},t.readAsArrayBuffer(Global.file)},geo:function(e){"use strict";function t(t){Global.GPSlat=t.coords.latitude,Global.GPSlong=t.coords.longitude,Global.GPSaccuracy=t.coords.accuracy,$("#city").text("GPS Active"),e.location=t,console.log(e.location)}function a(){Global.GPSlat="Location Unknown",Global.GPSlong="Location Unknown",$("#city").text(Global.GPSlat)}geoPosition.init()&&geoPosition.getCurrentPosition(t,a,{enableHighAccuracy:!0})},flash:function(){Global.flash.removeClass("hidden"),setTimeout(function(){Global.flash.addClass("hidden")},500)},activate:function(e){$(".active .fa-stack-1x").removeClass("blinky"),$(".active").removeClass("active"),"camchoice"===e?($("#camchoice .fa-stack-1x").addClass("blinky"),$("#camchoice").addClass("active")):"filechoice"===e&&($("#filechoice .fa-stack-1x").addClass("blinky"),$("#filechoice").addClass("active"))},onCameraFail:function(e){this.error=e.name||e,clearTimeout(window.turnOnCamera),clearInterval(window.cameraInterval)},size:function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&(a+=1);return a},isImage:function(e){return $.inArray(e,Global.imageTypes)>-1?(Tools.loading("stop"),!0):!1},cancel:function(){$("#cancel").click()},cancelEvent:function(e){return e=e?e:window.event,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1},loading:function(e,t){return e===!0?void $(".spinner").removeClass("hidden"):void("start"===e?$("#load").show():$("#load").hide())}},Filter={grayscale:function(e,t){for(var a=e.data,n=0;n<a.length;n+=4){var i=a[n],o=a[n+1],r=a[n+2],l=.2126*i+.7152*o+.0722*r;a[n]=a[n+1]=a[n+2]=l}return e},brightness:function(e,t){for(var a=e.data,n=0;n<a.length;n+=4)a[n]+=t,a[n+1]+=t,a[n+2]+=t;return e},threshold:function(e,t){for(var a=e.data,n=0;n<a.length;n+=4){var i=a[n],o=a[n+1],r=a[n+2],l=.2126*i+.7152*o+.0722*r>=t?255:0;a[n]=a[n+1]=a[n+2]=l}return e},invert:function(e,t){for(var a=e.data,n=0;n<a.length;n+=4)a[n]=a[n],a[n+1]=255-a[n+1],a[n+2]=255-a[n+2];return e},contrast:function(e,t,a){for(var n=e.data,i=259*(t+255)/(255*(259-t)),o=0;o<n.length;o+=4)n[o]=i*(n[o]-128)+128,n[o+1]=i*(n[o+1]-128)+128,n[o+2]=i*(n[o+2]-128)+128;return e},createImageData:function(e,t){var a=document.createElement("canvas"),n=a.getContext("2d");return n.createImageData(e,t)},convolute:function(e,t,a){for(var n=Math.round(Math.sqrt(t.length)),i=Math.floor(n/2),o=e.data,r=e.width,l=e.height,s=r,c=l,u=Filter.createImageData(s,c),d=u.data,f=a?1:0,h=0;c>h;h+=1)for(var g=0;s>g;g+=1){for(var m=h,p=g,v=4*(h*s+g),b=0,w=0,G=0,D=0,T=0;n>T;T+=1)for(var y=0;n>y;y+=1){var C=Math.min(l-1,Math.max(0,m+T-i)),S=Math.min(r-1,Math.max(0,p+y-i)),I=4*(C*r+S),_=t[T*n+y];b+=o[I]*_,w+=o[I+1]*_,G+=o[I+2]*_,D+=o[I+3]*_}d[v]=b,d[v+1]=w,d[v+2]=G,d[v+3]=D+f*(255-D)}return u},types:function(){Filter.gaussian=[6.7e-7,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,6.7e-7,2292e-8,78634e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,38771e-8,.01330373,.11098164,.22508352,.11098164,.01330373,38771e-8,19117e-8,.00655965,.05472157,.11098164,.05472157,.00655965,19117e-8,2292e-8,78633e-8,.00655965,.01330373,.00655965,78633e-8,2292e-8,6.7e-7,2292e-8,19117e-8,38771e-8,19117e-8,2292e-8,6.7e-7]}},Canvas={init:function(){Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.uploaderLink=$("a#previewerLink"),Global.canvas.width=850,Global.canvas.height=850,Global.video.addEventListener("loadedToolsdata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("canplaythrough",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("loadeddata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),Global.video.addEventListener("loadedmetadata",function(){Global.videoFeedLock===!1&&(Canvas.feed(),Global.videoFeedLock=!0)},!0),window.localMediaStream||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL,navigator.getUserMedia(Global.videoSettings,function(e){Global.video.src=window.URL.createObjectURL(e),window.localMediaStream=e,Canvas.resizeCanvas(),Tools.cancel(),Canvas.feed(),Tools.activate("camchoice")},Tools.onCameraFail))},stopCam:function(){"use strict";var e=document.querySelector("video");if(null!==e){e.src=null;try{window.localMediaStream.stop()}catch(t){}window.localMediaStream=null,e.load()}return!0},feed:function(){function e(){Global.video.videoHeight>Global.video.videoWidth?(Global.sourceX=0,Global.sourceY=(Global.video.videoHeight-Global.video.videoWidth)/2,Global.sourceWidth=Global.video.videoWidth,Global.sourceHeight=Global.video.videoWidth,Tools.loading("stop"),clearInterval(window.feedTimer)):Global.video.videoHeight<Global.video.videoWidth&&(Global.sourceX=(Global.video.videoWidth-Global.video.videoHeight)/2,Global.sourceY=0,Global.sourceWidth=Global.video.videoHeight,Global.sourceHeight=Global.video.videoHeight,Tools.loading("stop"),clearInterval(window.feedTimer))}function t(){Global.ctx.drawImage(Global.video,Global.sourceX,Global.sourceY,Global.sourceWidth,Global.sourceHeight,Global.destX,Global.destY,Global.destWidth,Global.destHeight)}window.localMediaStream&&(window.snapInterval&&clearInterval(window.snapInterval),$("canvas").attr("videoLive","on"),window.feedTimer||(window.feedTimer=setInterval(e,50)),Global.destWidth=Global.canvas.width,Global.destHeight=Global.canvas.height,Global.ctx=Global.canvas.getContext("2d"),window.snapInterval=setInterval(t,40))},freezer:function(){"on"===$("canvas").attr("videoLive")&&(clearInterval(window.snapInterval),$(this).attr("videoLive","off"))},releaser:function(){$(".active").hasClass("cam")&&(Canvas.feed(),$("canvas").attr("videoLive","on"))},transformCoordinate:function(e){var t=Global.canvas,a=Global.ctx,n=850,i=850;switch(e){case 5:case 6:case 7:case 8:t.width=n,t.height=i;break;default:t.width=i,t.height=n}switch(e){case 2:a.save(),a.translate(i,0),a.scale(-1,1);break;case 3:a.save(),a.translate(i,n),a.rotate(Math.PI);break;case 4:a.save(),a.translate(0,n),a.scale(1,-1);break;case 5:a.save(),a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.save(),a.rotate(.5*Math.PI),a.translate(0,-n);break;case 7:a.save(),a.rotate(.5*Math.PI),a.translate(i,-n),a.scale(-1,1);break;case 8:a.save(),a.rotate(-.5*Math.PI),a.translate(-i,0)}},drawImageIOSFix:function(e,t,a,n,i,o,r,l,s,c){function u(e){var t=(e.naturalWidth,e.naturalHeight);this.canvas.width=1,this.canvas.height=t,this.ctx.drawImage(e,0,0);for(var a=this.ctx.getImageData(0,0,1,t).data,n=0,i=t,o=t;o>n;){var r=a[4*(o-1)+3];0===r?i=o:n=o,o=i+n>>1}var l=o/t;return 0===l?1:l}this.canvas=document.createElement("canvas"),this.ctx=canvas.getContext("2d");var d=u(t);Canvas.transformCoordinate(Tools.exif("orientation")),e.drawImage(t,a*d,n*d,i*d,o*d,r,l,s,c);t.naturalWidth,t.naturalHeight},fromImage:function(e){Global.startWindowHeight=window.innerHeight,Global.video=document.querySelector("video"),Global.canvas=document.querySelector("canvas#previewer"),Global.ctx=Global.canvas.getContext("2d"),Global.file?(window.localMediaStream&&(clearInterval(window.snapInterval),Canvas.freezer()),Global.file=e.target.files[0],Global.imageObj.onload=function(){Tools.exif(),this.height>this.width?(Global.sourceX=0,Global.sourceY=(this.height-this.width)/2,Global.sourceWidth=this.width,Global.sourceHeight=this.width):(Global.sourceX=(this.width-this.height)/2,Global.sourceY=0,Global.sourceWidth=this.height,Global.sourceHeight=this.height),Global.canvas.width=850,Global.canvas.height=850,Global.destWidth=Global.canvas.width,Global.destHeight=Global.canvas.height,Global.ctx.drawImage(this,Global.sourceX,Global.sourceY,Global.sourceWidth,Global.sourceHeight,Global.destX,Global.destY,Global.destWidth,Global.destHeight)},Global.imageObj||(Global.imageObj=new Image),Global.imageObj.src=window.URL.createObjectURL(Global.file)):Tools.cancel()},resizeCanvas:function(){Global.previewH=window.innerHeight,Global.previewW=window.innerWidth;var e=Global.startWindowHeight-Global.previewH;$("footer").css(e>=36&&45>=e?{bottom:!1,top:"30px"}:{bottom:"60px",top:!1}),e=null,Global.previewH>Global.previewW?(Global.previewW>=850&&(Global.previewW=850),$(Global.canvas).css({width:Global.previewW+"px",height:Global.previewW+"px"})):(Global.previewW>=850&&Global.previewH>=920&&(Global.previewH=1700),$(Global.canvas).css({width:Global.previewH/1.5+"px",height:Global.previewH/1.5+"px"}))},filters:function(){"use strict";$(".filter.contrast").click(function(){Tools.loading("start","Processing Contrast."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.contrast(Global.imageData,20),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.BW").click(function(){Tools.loading("start","Processing Black&White."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.grayscale(Global.imageData),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.brighten").click(function(){Tools.loading("start","Processing Lighten."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.darken").click(function(){Tools.loading("start","Processing Darken."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,-5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.sharpen").click(function(){Tools.loading("start","Processing Sharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,[0,-1,0,-1,5,-1,0,-1,0]),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.blur").click(function(){Tools.loading("start","Processing Blur."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian,4),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.laplace").click(function(){Tools.loading("start","Processing Unsharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian),Global.iData2=Filter.convolute(Global.iData,Filter.gaussian),Global.iData3=Filter.convolute(Global.iData2,[-1,-2,-1,-2,13,-2,-1,-2,-1]),Global.ctx.putImageData(Global.iData3,0,0),Global.iData=null,Global.iData2=null,Global.iData3=null,Global.imageData=null},50),Tools.loading("stop")}),$("#clockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(90)},50),Tools.loading("stop")}),$("#counterclockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(-90)},50),Tools.loading("stop")})},rotate:function(e){var t=850,a=850;Global.tmpCanvas=new Image,Global.tmpCanvas.src=Global.canvas.toDataURL("image/png"),Global.tmpCanvas.onload=function(){Global.ctx.save(),Global.ctx.clearRect(0,0,Global.canvas.width,Global.canvas.height),Global.ctx.translate(Global.canvas.width/2,Global.canvas.height/2),Global.ctx.rotate(e*Math.PI/180),Global.ctx.drawImage(Global.tmpCanvas,-t/2,-a/2,t,a),Global.tmpCanvas=null,Global.ctx.restore()}},shove:function(){},crop:function(){},save:function(){Tools.loading(!0);var e=Global.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");window.location.href=e,e=null}};!function(){for(var e=0,t=["webkit","moz"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[a]+"CancelAnimationFrame"]||window[t[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,a){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),o=window.setTimeout(function(){t(n+i)},i);return e=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e,t){"use strict";var a=function(e,t,a){var n;return function(){function i(){a||e.apply(o,r),n=null}var o=this,r=arguments;n?clearTimeout(n):a&&e.apply(o,r),n=setTimeout(i,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),$(document).ready(function(){"use strict";$(window).smartresize(function(){setTimeout(function(){Canvas.resizeCanvas()},500)}),$("#camera,#camchoice").click(function(){function e(){Global.localMediaStream&&(clearTimeout(window.turnOnCamera),clearTimeout(window.cameraProblems),clearInterval(window.cameraInterval))}Tools.loading(!0),window.turnOnCamera=setTimeout(function(){$("#load").is(":visible")},5e3),window.cameraProblems=setTimeout(function(){$("#load").is(":visible")&&$("#nativeFile .fa").addClass("oneblink")},3e4),Canvas.init(),window.cameraInterval=setInterval(e,1e3)}),$("#nativeFile,#filechoice").click(function(){$("input#filechooser").trigger("click")}),$("input#filechooser").on("click",function(){function e(){Global.file&&(Tools.loading("stop"),clearInterval(window.fileInterval))}setTimeout(function(){Global.file||($("input#filechooser").attr("capture","camera").removeClass("hidden"),clearInterval(window.fileInterval))},15e3),window.fileInterval=setInterval(e,100)}).off("change").on("change",function(e){Global.file=this.files[0],Global.file&&(Tools.isImage(Global.file.type)===!0?(Canvas.fromImage(e),Tools.activate("filechoice"),$(".step1").hide(),$(".step3").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500)):setTimeout(function(){window.location.reload(!0)},3e3))}),$("#accept.action,canvas").click(function(){Tools.flash(),$(".step1").hide(),$(".step2").hide().removeClass("hidden").fadeIn(500),Canvas.freezer()}),$("#cancel").click(function(){$(".step2").hide(),$(".step1").fadeIn(500),$(".step3").hide(),Canvas.releaser()}),$("#settings span.trigger").click(function(){$(".step3").hasClass("hidden")?($(".step3").hide().removeClass("hidden").fadeIn(500),$("#settings i.fa-stack-2x").addClass("fa-circle"),$("#settings i.fa-stack-1x").addClass("white")):($(".step3").fadeOut(250).addClass("hidden"),$("#settings .trigger").blur(),$("#settings .fa-stack-2x").removeClass("fa-circle"),$("#settings .fa-stack-1x").removeClass("white"))}),$(".step3 button").click(function(){$("#settings .trigger").click()}),$("#upload").bind("click",function(e){$(".step2").addClass("hidden"),Canvas.save(),$("#cancel").click()}),$(".filter.contrast").click(function(){Tools.loading("start","Processing Contrast."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.contrast(Global.imageData,20),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.BW").click(function(){Tools.loading("start","Processing Black&White."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.grayscale(Global.imageData),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.brighten").click(function(){Tools.loading("start","Processing Lighten."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.darken").click(function(){Tools.loading("start","Processing Darken."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Filter.brightness(Global.imageData,-5),Global.ctx.putImageData(Global.imageData,0,0),Global.imageData=null},50),Tools.loading("stop")}),$(".filter.sharpen").click(function(){Tools.loading("start","Processing Sharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,[0,-1,0,-1,5,-1,0,-1,0]),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.blur").click(function(){Tools.loading("start","Processing Blur."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian,4),Global.ctx.putImageData(Global.iData,0,0),Global.iData=null,Global.imageData=null},50),Tools.loading("stop")}),$(".filter.laplace").click(function(){Tools.loading("start","Processing Unsharpen."),setTimeout(function(){Global.imageData=Global.ctx.getImageData(0,0,Global.canvas.width,Global.canvas.height),Global.iData=Filter.convolute(Global.imageData,Filter.gaussian),Global.iData2=Filter.convolute(Global.iData,Filter.gaussian),Global.iData3=Filter.convolute(Global.iData2,[-1,-2,-1,-2,13,-2,-1,-2,-1]),Global.ctx.putImageData(Global.iData3,0,0),Global.iData=null,Global.iData2=null,Global.iData3=null,Global.imageData=null},50),Tools.loading("stop")}),$("#clockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(90)},50),Tools.loading("stop")}),$("#counterclockwise").click(function(){Tools.loading("start","Processing Rotation."),setTimeout(function(){Canvas.rotate(-90)},50),Tools.loading("stop")})});